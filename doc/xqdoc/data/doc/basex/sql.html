<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>XQuery documentation </title>
    <link rel="stylesheet" type="text/css" href="../../../style.css"></link>
  </head>
  <body>
    <div class="right">
      <img width="104" src="../../../basex.svg"></img>
    </div>
    <h2>Library Module: data/doc/basex.xqm/sql.xqm</h2>
    <table>
      <tr>
        <td>
          <b>URI:</b>
        </td>
        <td>
          <code>http://basex.org/modules/sql</code>
        </td>
      </tr>
      <tr>
        <td>
          <b>Description:</b>
        </td>
        <td>This <a href="http://docs.basex.org/wiki/Module_Library">XQuery Module</a> contains functions to access relational databases from XQuery using SQL. With this module, you can execute query, update and prepared statements, and the result sets are returned as sequences of XML elements representing tuples. Each element has children representing the columns returned by the SQL statement.</td>
      </tr>
      <tr>
        <td>
          <b>Author:</b>
        </td>
        <td>BaseX Team</td>
      </tr>
      <tr>
        <td>
          <b>See:</b>
        </td>
        <td>http://docs.basex.org/wiki/Module_Library</td>
      </tr>
    </table>
    <h2>Functions</h2>
    <a name="close#1">
      <h3>close($connection)</h3>
    </a>
    <table>
      <tr>
        <td>
          <b>Arguments:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>$connection</code>
              </td>
              <td>
                <code>xs:integer</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Returns:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>empty-sequence()</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Description:</b>
        </td>
        <td>This function closes a connection to a relational database. <code>$connection</code> specifies the connection handle.</td>
      </tr>
      <tr>
        <td>
          <b>Error:</b>
        </td>
        <td>bxerr:BXSQ0001 an SQL exception occurs.</td>
      </tr>
    </table>
    <a name="commit#1">
      <h3>commit($connection)</h3>
    </a>
    <table>
      <tr>
        <td>
          <b>Arguments:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>$connection</code>
              </td>
              <td>
                <code>xs:integer</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Returns:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>empty-sequence()</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Description:</b>
        </td>
        <td>This function commits the changes made to a relational database. <code>$connection</code> specifies the connection handle.</td>
      </tr>
      <tr>
        <td>
          <b>Error:</b>
        </td>
        <td>bxerr:BXSQ0001 an SQL exception occurs.</td>
      </tr>
    </table>
    <a name="connect#1">
      <h3>connect($url)</h3>
    </a>
    <table>
      <tr>
        <td>
          <b>Arguments:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>$url</code>
              </td>
              <td>
                <code>xs:string</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Returns:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>xs:integer</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Description:</b>
        </td>
        <td>This function establishes a connection to a relational database. As a result a connection handle is returned. The parameter <code>$url</code> is the URL of the database and shall be of the form: <code>jdbc:&lt;driver name&gt;:[//&lt;server&gt;[/&lt;database&gt;]]</code> . If the parameters <code>$user</code> and <code>$password</code> are specified, they are used as credentials for connecting to the database. The <code>$options</code> parameter can be used to set connection options, which can either be specified
<ul> <li> as children of an <code>&lt;sql:options/&gt;</code> element, e.g.: </li> </ul>  <pre class="brush:xml"> &lt;sql:options&gt; &lt;sql:autocommit value='true'/&gt; ... &lt;/sql:options&gt; </pre>  <ul> <li> as map, which contains all key/value pairs: </li> </ul>  <pre class="brush:xml"> map { "autocommit": true(), ... } </pre>
        </td>
      </tr>
      <tr>
        <td>
          <b>Error:</b>
        </td>
        <td>bxerr:BXSQ0001 an SQL exception occurs, e.g. missing JDBC driver or not existing relation.</td>
      </tr>
    </table>
    <a name="connect#3">
      <h3>connect($url, $user, $password)</h3>
    </a>
    <table>
      <tr>
        <td>
          <b>Arguments:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>$url</code>
              </td>
              <td>
                <code>xs:string</code>
              </td>
              <td></td>
            </tr>
            <tr>
              <td>
                <code>$user</code>
              </td>
              <td>
                <code>xs:string</code>
              </td>
              <td></td>
            </tr>
            <tr>
              <td>
                <code>$password</code>
              </td>
              <td>
                <code>xs:string</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Returns:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>xs:integer</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Description:</b>
        </td>
        <td>This function establishes a connection to a relational database. As a result a connection handle is returned. The parameter <code>$url</code> is the URL of the database and shall be of the form: <code>jdbc:&lt;driver name&gt;:[//&lt;server&gt;[/&lt;database&gt;]]</code> . If the parameters <code>$user</code> and <code>$password</code> are specified, they are used as credentials for connecting to the database. The <code>$options</code> parameter can be used to set connection options, which can either be specified
<ul> <li> as children of an <code>&lt;sql:options/&gt;</code> element, e.g.: </li> </ul>  <pre class="brush:xml"> &lt;sql:options&gt; &lt;sql:autocommit value='true'/&gt; ... &lt;/sql:options&gt; </pre>  <ul> <li> as map, which contains all key/value pairs: </li> </ul>  <pre class="brush:xml"> map { "autocommit": true(), ... } </pre>
        </td>
      </tr>
      <tr>
        <td>
          <b>Error:</b>
        </td>
        <td>bxerr:BXSQ0001 an SQL exception occurs, e.g. missing JDBC driver or not existing relation.</td>
      </tr>
    </table>
    <a name="connect#4">
      <h3>connect($url, $user, $password, $options)</h3>
    </a>
    <table>
      <tr>
        <td>
          <b>Arguments:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>$url</code>
              </td>
              <td>
                <code>xs:string</code>
              </td>
              <td></td>
            </tr>
            <tr>
              <td>
                <code>$user</code>
              </td>
              <td>
                <code>xs:string</code>
              </td>
              <td></td>
            </tr>
            <tr>
              <td>
                <code>$password</code>
              </td>
              <td>
                <code>xs:string</code>
              </td>
              <td></td>
            </tr>
            <tr>
              <td>
                <code>$options</code>
              </td>
              <td>
                <code>item()</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Returns:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>xs:integer</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Description:</b>
        </td>
        <td>This function establishes a connection to a relational database. As a result a connection handle is returned. The parameter <code>$url</code> is the URL of the database and shall be of the form: <code>jdbc:&lt;driver name&gt;:[//&lt;server&gt;[/&lt;database&gt;]]</code> . If the parameters <code>$user</code> and <code>$password</code> are specified, they are used as credentials for connecting to the database. The <code>$options</code> parameter can be used to set connection options, which can either be specified
<ul> <li> as children of an <code>&lt;sql:options/&gt;</code> element, e.g.: </li> </ul>  <pre class="brush:xml"> &lt;sql:options&gt; &lt;sql:autocommit value='true'/&gt; ... &lt;/sql:options&gt; </pre>  <ul> <li> as map, which contains all key/value pairs: </li> </ul>  <pre class="brush:xml"> map { "autocommit": true(), ... } </pre>
        </td>
      </tr>
      <tr>
        <td>
          <b>Error:</b>
        </td>
        <td>bxerr:BXSQ0001 an SQL exception occurs, e.g. missing JDBC driver or not existing relation.</td>
      </tr>
    </table>
    <a name="execute#2">
      <h3>execute($connection, $query)</h3>
    </a>
    <table>
      <tr>
        <td>
          <b>Arguments:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>$connection</code>
              </td>
              <td>
                <code>xs:integer</code>
              </td>
              <td></td>
            </tr>
            <tr>
              <td>
                <code>$query</code>
              </td>
              <td>
                <code>xs:string</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Returns:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>element()*</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Description:</b>
        </td>
        <td>This function executes a query or update statement. The parameter <code>$connection</code> specifies a connection handle. The parameter <code>$query</code> is a string representing an SQL statement.</td>
      </tr>
      <tr>
        <td>
          <b>Error:</b>
        </td>
        <td>bxerr:BXSQ0001 an SQL exception occurs, e.g. not existing relation is retrieved.</td>
      </tr>
    </table>
    <a name="execute-prepared#2">
      <h3>execute-prepared($id, $params)</h3>
    </a>
    <table>
      <tr>
        <td>
          <b>Arguments:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>$id</code>
              </td>
              <td>
                <code>xs:integer</code>
              </td>
              <td></td>
            </tr>
            <tr>
              <td>
                <code>$params</code>
              </td>
              <td>
                <code>element(sql:parameters)</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Returns:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>element()*</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Description:</b>
        </td>
        <td>This function executes a prepared statement. The parameter <code>$id</code> specifies a prepared statement handle. The optional parameter <code>$params</code> is an element <code>&lt;sql:parameters/&gt;</code> representing the parameters for a prepared statement along with their types and values. The following schema shall be used:
<pre class="brush:xml"> element sql:parameters { element sql:parameter { attribute type { "int"|"string"|"boolean"|"date"|"double"|"float"|"short"|"time"|"timestamp" }, attribute null { "true"|"false" }?, text }+ }? </pre>
        </td>
      </tr>
      <tr>
        <td>
          <b>Error:</b>
        </td>
        <td>bxerr:BXSQ0001 an SQL exception occurs, e.g. not existing relation is retrieved.</td>
      </tr>
    </table>
    <a name="init#1">
      <h3>init($class)</h3>
    </a>
    <table>
      <tr>
        <td>
          <b>Arguments:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>$class</code>
              </td>
              <td>
                <code>xs:string</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Returns:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>empty-sequence()</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Description:</b>
        </td>
        <td>This function initializes a JDBC driver specified via <code>$class</code> . This step might be superfluous if the SQL database is not embedded.</td>
      </tr>
      <tr>
        <td>
          <b>Error:</b>
        </td>
        <td>bxerr:BXSQ0007 the specified driver class is not found.</td>
      </tr>
    </table>
    <a name="prepare#2">
      <h3>prepare($connection, $statement)</h3>
    </a>
    <table>
      <tr>
        <td>
          <b>Arguments:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>$connection</code>
              </td>
              <td>
                <code>xs:integer</code>
              </td>
              <td></td>
            </tr>
            <tr>
              <td>
                <code>$statement</code>
              </td>
              <td>
                <code>xs:string</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Returns:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>xs:integer</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Description:</b>
        </td>
        <td>This function prepares a statement and returns a handle to it. The parameter <code>$connection</code> indicates the connection handle to be used. The parameter <code>$statement</code> is a string representing an SQL statement with one or more '?' placeholders. If the value of a field has to be set to <code>NULL</code> , then the attribute <code>null</code> of the element <code>&lt;sql:parameter/&gt;</code> has to be <code>true</code> .</td>
      </tr>
      <tr>
        <td>
          <b>Error:</b>
        </td>
        <td>bxerr:BXSQ0001 an SQL exception occurs.</td>
      </tr>
    </table>
    <a name="rollback#1">
      <h3>rollback($connection)</h3>
    </a>
    <table>
      <tr>
        <td>
          <b>Arguments:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>$connection</code>
              </td>
              <td>
                <code>xs:integer</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Returns:</b>
        </td>
        <td>
          <table>
            <tr>
              <td>
                <code>empty-sequence()</code>
              </td>
              <td></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <b>Description:</b>
        </td>
        <td>This function rolls back the changes made to a relational database. <code>$connection</code> specifies the connection handle.</td>
      </tr>
      <tr>
        <td>
          <b>Error:</b>
        </td>
        <td>bxerr:BXSQ0001 an SQL exception occurs.</td>
      </tr>
    </table>
  </body>
</html>